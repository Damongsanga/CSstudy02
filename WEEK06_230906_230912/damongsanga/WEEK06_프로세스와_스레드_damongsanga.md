## 3.3 프로세스와 스레드

- 프로그램 : 특정 작업을 실행할 수 있도록 해주는 코드의 집합
- 프로세스 : 메모리에 올라가서 **인스턴스화**된 프로그램
  - CPU 스케줄링의 대상
- 스레드 : 프로세스 내의 작업 흐름
  - 프로세스는 최소 1개의 스레드로 이루어져 있다

### 3.3.1 프로세스와 컴파일 과정

#### 프로그램의 인스턴스화

- 컴파일 : 컴파일러를 통해 기계어로 번역되어 실행될 수 있는 파일로 전환
  _ 여기서 인터프리트 언어와는 별개
  _ C 언어를 예시로 설명
  _ 전처리 : 코드의 주석을 제거하고 #include 등 헤더 파일을 병합하여 매크로를 치환
  _ 컴파일러 : 오류 처리, 코드 최적화 작업을 하여 어셈블리어로 변환
  _ 어셈블러 : 어셈블리어를 목적 코드(object code) 로 변환
  _ 확장자 : 리눅스 기준 .o
  _ 링커 : 프로그램 내에 있는 라이브러리 함수 및 다른 파일들의 목적코드와 결합하여 실행파일을 만듬
  _ 확장자 : .exe, .out
  <br>
- 정적 라이브러리와 동적 라이브러리
  - 정적 라이브러리 : 프로그램 빌드시 라이브러리가 제공하는 모든 코일을 실행 파일에 넣는 방식
    - 장점 : 시스템 환경 외부 의존도가 낮음
    - 단점 : 코드 중복 등 메모리 효율성 감소
  - 동적 라이브러리 : 프로그램 실행시에 필요할 때만 함수 정보를 참조하여 라이브러리 사용하는 방식 (DDL)
    - 장단점은 정적 라이브러리의 반대

### 3.3.2 프로세스의 상태

##### 1. 생성상태

프로세스가 할당된 상태

- fork() , exec() 함수를 통해 생성
  - fork() : 부모 프로세스의 주소 공간을 그대로 복사하여 새로운 자식 프로세스를 생성하는 함수
    - 주소공간만 복사할 뿐 부모 프로세스의 비동기 작업등을 상속하지 않음
  - exec() : 아예 새로운 프로세스를 생성하는 함수
- PCB 할당

##### 2. 대기상태

CPU 스케줄러로 부터 CPU 소유권이 넘어고기를 기다리는 상태

- 메모리 공간이 충분하면 메모리를 할당받고 아니면 대기하고 있음

##### 3. 대기 중단 상태

메모리 부족으로 일시 중단된 상태

##### 4. 실행 상태

CPU 소유권이 메모리를 할당 받고 인스트럭션을 수행중인 상태

- CPU Burst라고 표현하기도 함
- Burst : 어떠한 작업이 집중적으로 이루어지는 구간
  - **프로세스는 IO Burst와 CPU Burst의 연속이라고 할 수 있다!**

##### 5. 중단 상태

어떤 이벤트가 발생하여 프로세스가 차단된 상태

- 대표적으로 I/O 디바이스에 의한 인터럽트 등이 있음

##### 6. 일시 중단 상태

대기 중단과 유사한 상태로 중단된 상태에서 프로세스가 실행되려고 했으나 메모리 부족으로 일시 중단된 상태 (?)

##### 7. 종료 상태

메모리와 CPU 소유권을 모두 놓고 가는 상태?

- 작업이 모두 실행되어 자연스럽게 종료되는 경우
- 강제 종료되는 경우
  - 자식 프로세스에 할당된 자원의 한계치를 넘어서는 경우 강제 종료
  - 부모 프로세스가 종료될 때 강제 종료
  - 사용자가 process.kill 명령어로 강제 종료

### 3.3.3 프로세스의 메모리 구조

- 위에서 부터 기술
- 동적 영역
  - 스택 : 위 주소부터 할당
  - 힙 : 아래 주소부터 할당
- 정적 영역
  - 데이터영역 (BSS Segment, Data Segment)
  - 코드 영역

#### 스택 영역

- 지역변수, 매개변수, 함수가 저장되는 영역
- 컴파일시 크기 결정
- 동적 영역 : 함수가 함수를 재귀적으로 호출하면서 동적으로 크기가 늘어날 수 있음
  - 이 때 힙과 스택 메모리 영역이 겹치지 않도록 사이 공간을 비워둠

#### 힙 영역

- 벡터와 같은 동적 배열 할당되는 영역
- 런타임시 크기 결정
- 동적 영역

#### 데이터 영역

- 전역변수, 정적변수 저장
- BSS Segment : 초기화 되지 않은 변수가 0으로 초기화되어 저장
- Data Segment : 0이 아닌 다른 값으로 할당된 변수들이 저장
- 정적 영역

#### 코드 영역

- 프로그램에 내장된 소스코드가 들어가있는 영역
- 수정 불가능한 기계어로 저장
- 정적 영역

### 3.3.4 PCB

#### PCB (Process Control Block) : OS에서 프로세스에 대한 메타데이터를 저장한 데이터

- 프로세스 생성시 OS에 의해 생성됨
- 이 때 프로세스 주소값
- 일반 사용자가 접근하지 못하도록 **커널 스택 가장 앞 부분에서 관리**
- PCB가 관리하는 메타데이터
  (1) **OS가 관리상 사용하는 정보 :** Process state, Process ID, scheduling information proirty
  (2) **CPU 수행 관련 하드웨어 값 :** Program counter, resisters
  (3) **메모리 관련 :** Code,data,stack 위치정보
  (4) **파일 관련 :** Open file descriptors
  (아래서 다시 정리)

##### PCB 구조

- 프로세스 스케줄링 상태 : "준비", "일시중단", "생성", "사용중" 등
- 프로세스 ID (PID) : 틀정 프로세스를 식별하기 위한 고유정보
  - 자신과 자신의 자식 프로세스의 PID를 가ㅣ고 있음
- 프로세스 권한 :
- **프로그램 카운터 : 프로로세스에서 실행해야 할 다음 명령어의 주소에 대한 포인터**
- CPU 레지스터 : 프로세스를 실행하기 위해 저장해야 할 레지스터에 대한 정보
- CPU 스케줄링 정보 : 어떤 순서로 CPU를 할당 받을지, 스케줄러에 의해 중단된 시간 등에 대한 정보
- 계정 정보 : 프로세스 실행에 사용된 CPU 사용량, 실행 유저 정보 등
- I/O 정보 : 프로세스에 할당된 I/O 디바이스 목록

#### Context Switching (문맥교환)

- PCB를 교환하는 과정
- 문맥 (Context) :

### 3.3.5 멀티 프로세싱

### 3.3.6 스레드와 멀티 스레딩

### 3.3.7 공유자원과 임계 영역

### 3.3.8 교착상태
